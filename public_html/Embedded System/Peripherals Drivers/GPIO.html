<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>GPIO Overview</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="GPIO Overview"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-11-29T00:48+0800"/>
<meta name="author" content="Shi Shougang"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="./assets/stylesheet.css" type="text/css"/>
<link rel="stylesheet" type="text/css" href="../../assets/stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">GPIO Overview</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">GPIO Driver</a>
<ul>
<li><a href="#sec-1-1">Introduction</a></li>
<li><a href="#sec-1-2">Driver Configuration</a></li>
<li><a href="#sec-1-3">IRQ handling</a></li>
<li><a href="#sec-1-4">Driver Usage</a></li>
</ul>
</li>
<li><a href="#sec-2">Notes from gpio in kernel docs</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">GPIO Driver</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">Introduction</h3>
<div class="outline-text-3" id="text-1-1">

<p>site:
<a href="http://processors.wiki.ti.com/index.php/TI81XX_PSP_GPIO_Driver_User_Guide">http://processors.wiki.ti.com/index.php/TI81XX_PSP_GPIO_Driver_User_Guide</a>
</p>
<p>
NOTE:
</p>
<p>
Linux GPIO numbers start from "0".
</p>
<p>
NOTE
</p>
<p>
Some TI SoCs have multiple banks of GPIOs.
For example the TI814x has 4 banks of 32 GPIOs, for a total of 128 GPIO, i.e Bank-0[0..31], Bank-1[0..31], Bank-2[0..31], Bank-3[0..31].
</p>
<p>
In this case Bank-1[0..31] maps to Linux GPIO numbers 32..63, Bank-2[0..31] to Linux GPIO numbers 64..95 etc.
</p>
</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">Driver Configuration</h3>
<div class="outline-text-3" id="text-1-2">

<p>The default kernel configuration enables support for GPIO driver (built into the kernel).
</p>
<p>
To enable or disable GPIO driver from kernel build, follow these steps:
</p>


<pre class="src src-sh">$ make <span style="color: #eedd82;">CROSS_COMPILE</span>=arm-none-linux-gnueabi- <span style="color: #eedd82;">ARCH</span>=arm menuconfig
</pre>

<ul>
<li>Select Device Drivers from the main menu.
</li>
</ul>




<pre class="src src-sh">    Power management options  ---&gt;
[*] Networking support  ---&gt;
    Device Drivers  ---&gt;
    File systems  ---&gt;
...
...
</pre>

<ul>
<li>Select GPIO Support from the menu.
</li>
</ul>




<pre class="src src-sh">    PPS support  ---&gt;
    PTP clock support  ---&gt;
-*- GPIO Support  ---&gt;
&lt; &gt; Dallas<span style="color: #ffa07a;">'s 1-wire support  ---&gt;</span>
<span style="color: #ffa07a;">...</span>
<span style="color: #ffa07a;">...</span>
</pre>

<ul>
<li>Sysfs entries configuration
  GPIO can be access using SYSFS entries from User Space. For that Select <i>sys/class/gpio</i>&hellip; (sysfs interface) from the GPIO support.
</li>
</ul>




<pre class="src src-sh">[ ] Debug GPIO calls
[*] /sys/class/gpio/... (sysfs interface)
    *** Memory mapped GPIO drivers: ***
&lt; &gt; Basic memory-mapped GPIO controllers support
...
...
</pre>

<p>
After doing driver selection, exit and save the kernel configuration when prompted.
</p></div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3">IRQ handling</h3>
<div class="outline-text-3" id="text-1-3">

<p>   GPIO pin is also used as a interrupt source, these are the general usage of IRQ handling using GPIO lines.
</p>
<ul>
<li>Map GPIO number to corresponding IRQ number, GPIO 0 need not use IRQ 0
</li>
</ul>




<pre class="src src-sh"><span style="color: #eedd82;">irq_num</span> = gpio_to_irq(30)
</pre>

<ul>
<li>Request IRQ, make sure that irq<sub>num</sub> should be non-error value
</li>
</ul>




<pre class="src src-sh"><span style="color: #87cefa;">request_irq</span>(irq_num, handler, 0, <span style="color: #ffa07a;">"gpio_test"</span>, NULL);
</pre>

<ul>
<li>Set IRQ type Raising/Falling/Level triggered
</li>
</ul>




<pre class="src src-sh"><span style="color: #87cefa;">set_irq_type</span>(irq_num, IRQ_TYPE_EDGE_RISING);
</pre>

<ul>
<li>During the clean-up path free the IRQ and gpio
</li>
</ul>




<pre class="src src-sh"><span style="color: #87cefa;">free_irq</span>(irq_num, NULL);
<span style="color: #87cefa;">gpio_free</span>(30);
</pre>



</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4">Driver Usage</h3>
<div class="outline-text-3" id="text-1-4">

<ul>
<li id="sec-1-4-1">Kernel Level<br/>
<ul>
<li>Allocate memory to GPIO line, can be achieved by doing gpio<sub>request</sub>()
</li>
</ul>




<pre class="src src-c">err = gpio_request(30, <span style="color: #ffa07a;">"sample_name"</span>);
</pre>

<ul>
<li>Depending on the requirement set GPIO as input or output pin then set gpio value as high or low.
  Setting the GPIO pin 30 as input
</li>
</ul>




<pre class="src src-c">gpio_direction_input(30);
</pre>

<p>
  Make pin 30 as output and set the value as high.
</p>


<pre class="src src-c">gpio_direction_output(30, 1);
</pre>

<p>
  Exporting that particular pin (30) to sysfs entry then use this API
</p>


<pre class="src src-c">gpio_export(30, <span style="color: #7fffd4;">true</span>);
</pre>

<p>
  Get value from GPIO pin
</p>


<pre class="src src-c">gpio_get_value(30);
</pre>

</li>
</ul>
<ul>
<li id="sec-1-4-2">User Space - Sysfs control<br/>
<ul>
<li>Enable GPIO sysfs support in kernel configuration and build the kernel
</li>
</ul>




<pre class="src src-sh">Device Drivers  ---&gt; GPIO Support  ---&gt; /sys/class/gpio/... (sysfs interface)
</pre>

<ul>
<li>Sysfs entries
  Export the particular GPIO pin for user control. GPIO30 is taken as example.
</li>
</ul>




<pre class="src src-sh">$ echo 30 &gt; /sys/class/gpio/export
</pre>

<p>
  Change the GPIO pin direction to in/out
</p>


<pre class="src src-sh">$ echo <span style="color: #ffa07a;">"out"</span> &gt; /sys/class/gpio/gpio30/direction
or
$ echo <span style="color: #ffa07a;">"in"</span> &gt; /sys/class/gpio/gpio30/direction
</pre>

<p>
Change the value
</p>


<pre class="src src-sh">$ echo 1 &gt; /sys/class/gpio/gpio30/value
or
$ echo 0 &gt; /sys/class/gpio/gpio30/value
</pre>

<p>
  Unexport the GPIO pin
</p>


<pre class="src src-sh">$ echo 30 &gt; /sys/class/gpio/unexport
</pre>


<p>
 <b>Note:</b> GPIO's which are used already in the drivers can not be control from sysfs, unless until driver export that particular pin.
</p>
<p>
Run these commands for knowing what are the GPIO's already requested in the drivers.
</p>


<pre class="src src-sh">$ mount -t debugfs debugfs /sys/kernel/debug
$ cat /sys/kernel/debug/gpio
</pre>



</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Notes from gpio in kernel docs</h2>
<div class="outline-text-2" id="text-2">

<p><a href="http://www.kernel.org/doc/Documentation/gpio.txt">http://www.kernel.org/doc/Documentation/gpio.txt</a>
</p></div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-11-29T00:48+0800</p>
<p class="author">Author: Shi Shougang</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.2+ with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
