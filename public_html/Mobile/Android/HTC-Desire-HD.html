<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>HTC Desire HD</title>
<!-- 2016-05-26 Thu 22:03 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Shi Shougang" />
<link href="../../assets/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="../../assets/bootstrap-responsive.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../assets/stylesheet.css" />
<script src="assets/js/bootstrap.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">HTC Desire HD</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Overview</a></li>
<li><a href="#sec-2">2. A high-level DHD/Inspire manual S-OFF hack concept for advanced users</a></li>
<li><a href="#sec-3">3. Building for HTC Desire HD(ICS)</a>
<ul>
<li><a href="#sec-3-1">3.1. set up</a></li>
<li><a href="#sec-3-2">3.2. set htc</a></li>
<li><a href="#sec-3-3">3.3. repo sync</a></li>
<li><a href="#sec-3-4">3.4. patches</a></li>
<li><a href="#sec-3-5">3.5. build</a></li>
</ul>
</li>
<li><a href="#sec-4">4. CM10.1 JellyBean</a></li>
<li><a href="#sec-5">5. How to Build CyanogenMod for Desire HD / Inspire 4G (codename: ace)</a>
<ul>
<li><a href="#sec-5-1">5.1. Install the SDK</a></li>
<li><a href="#sec-5-2">5.2. Install the Build Packages</a></li>
<li><a href="#sec-5-3">5.3. Create the directories</a></li>
<li><a href="#sec-5-4">5.4. Install the repo command</a></li>
<li><a href="#sec-5-5">5.5. Initialize the CyanogenMod source repository</a></li>
<li><a href="#sec-5-6">5.6. Download the source code</a></li>
<li><a href="#sec-5-7">5.7. Get prebuilt Rom Manager</a></li>
<li><a href="#sec-5-8">5.8. Prepare the device-specific code</a></li>
<li><a href="#sec-5-9">5.9. Extract proprietary blobs</a></li>
<li><a href="#sec-5-10">5.10. Turn on caching to speed up build</a></li>
<li><a href="#sec-5-11">5.11. Start the build</a></li>
<li><a href="#sec-5-12">5.12. If the build breaks&#x2026;</a></li>
<li><a href="#sec-5-13">5.13. Install the build</a></li>
<li><a href="#sec-5-14">5.14. Install CyanogenMod</a></li>
<li><a href="#sec-5-15">5.15. FAQ</a>
<ul>
<li><a href="#sec-5-15-1">5.15.1. Duplicate device 'CyanogenMod/android<sub>device</sub><sub>htc</sub><sub>ace'</sub> found in local manifest</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">6. install</a></li>
<li><a href="#sec-7">7. Development by SHI</a></li>
</ul>
</div>
</div>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="http://forum.xda-developers.com/wiki/HTC_Desire_HD">http://forum.xda-developers.com/wiki/HTC_Desire_HD</a>
</p>

<p>
<a href="http://forum.xda-developers.com/forumdisplay.php?f=765">http://forum.xda-developers.com/forumdisplay.php?f=765</a>
</p>

<p>
<a href="http://wiki.cyanogenmod.org/w/Ace_Info">http://wiki.cyanogenmod.org/w/Ace_Info</a>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> A high-level DHD/Inspire manual S-OFF hack concept for advanced users</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="http://tau.shadowchild.nl/attn1/?cat=6|">http://tau.shadowchild.nl/attn1/?cat=6|</a>
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Building for HTC Desire HD(ICS)</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="http://blog.david-reid.com/2012/03/02/building-for-htc-desire-hd/">http://blog.david-reid.com/2012/03/02/building-for-htc-desire-hd/</a>
</p>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> set up</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b0c4de;">cd</span> work
mkdir bin
curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo &gt; bin/repo
chmod a+x bin/repo
mkdir android/system
<span style="color: #b0c4de;">cd</span> android/system/
repo init -u git://github.com/CyanogenMod/android.git -b ics
</pre>
</div>

<p>
Before starting the long first sync, we need to add some extra
repositories to the build as presently the Desire HD isn’t included
“out of the box”.
</p>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> set htc</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Create a file, .repo/local<sub>manifest</sub>.xml with the following contents
</p>
<div class="org-src-container">

<pre class="src src-sh">&lt;?xml <span style="color: #eedd82;">version</span>=<span style="color: #ffa07a;">"1.0"</span> <span style="color: #eedd82;">encoding</span>=<span style="color: #ffa07a;">"UTF-8"</span>?&gt;
&lt;manifest&gt;
  &lt;project <span style="color: #eedd82;">name</span>=<span style="color: #ffa07a;">"CyanogenMod/android_device_htc_ace"</span>
           <span style="color: #eedd82;">path</span>=<span style="color: #ffa07a;">"device/htc/ace"</span> <span style="color: #eedd82;">remote</span>=<span style="color: #ffa07a;">"github"</span> /&gt;
  &lt;project <span style="color: #eedd82;">name</span>=<span style="color: #ffa07a;">"CyanogenMod/android_device_htc_common"</span>
           <span style="color: #eedd82;">path</span>=<span style="color: #ffa07a;">"device/htc/common"</span>
           <span style="color: #eedd82;">revision</span>=<span style="color: #ffa07a;">"refs/heads/gingerbread"</span>/&gt;
  &lt;project <span style="color: #eedd82;">name</span>=<span style="color: #ffa07a;">"CyanogenMod/android_device_htc_msm7x30-common"</span>
           <span style="color: #eedd82;">path</span>=<span style="color: #ffa07a;">"device/htc/msm7x30-common"</span> <span style="color: #eedd82;">remote</span>=<span style="color: #ffa07a;">"github"</span> /&gt;
  &lt;project <span style="color: #eedd82;">name</span>=<span style="color: #ffa07a;">"koush/proprietary_vendor_htc"</span>
           <span style="color: #eedd82;">path</span>=<span style="color: #ffa07a;">"vendor/htc"</span> /&gt;
&lt;/manifest&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> repo sync</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-sh">repo sync -j16
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">get some prebuilt files</span>
<span style="color: #b0c4de;">cd</span> vendor/cm/
./get-prebuilts
<span style="color: #b0c4de;">cd</span> ../..
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> patches</h3>
<div class="outline-text-3" id="text-3-4">
<p>
At this point the codebase will build but will not boot. To fix this,
you need to edit the file device/htc/ace/media<sub>profiles</sub>.xml as
follows.
</p>

<div class="org-src-container">

<pre class="src src-sh">Insert @ line 77:
&lt; !ATTLIST VideoEditorCap maxPrefetchYUVFrames CDATA <span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">REQUIRED&gt;</span>
Change line 250 from
        <span style="color: #eedd82;">maxOutputFrameHeight</span>=<span style="color: #ffa07a;">"720"</span>/&gt;
to
        <span style="color: #eedd82;">maxOutputFrameHeight</span>=<span style="color: #ffa07a;">"720"</span> <span style="color: #eedd82;">maxPrefetchYUVFrames</span>=<span style="color: #ffa07a;">"10"</span>/&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> build</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">

<pre class="src src-sh">. build/envsetup.sh
brunch ace
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> CM10.1 JellyBean</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="http://forum.xda-developers.com/showthread.php?t=2093845">http://forum.xda-developers.com/showthread.php?t=2093845</a>
</p>

<div class="org-src-container">

<pre class="src src-sh">mkdir cm10
<span style="color: #b0c4de;">cd</span> cm10/
repo init -u git://github.com/CyanogenMod/android.git -b cm-10.1
mkdir -p .repo/local_manifests
wget https://github.com/Mustaavalkosta/android/raw/cm-10.1/local_manifest.xml -O .repo/local_manifests/cm_ace.xml
repo sync
<span style="color: #b0c4de;">cd</span> vendor/cm/
./get-prebuilts
<span style="color: #b0c4de;">cd</span> ../../
. build/envsetup.sh
lunch cm_ace-userdebug
mka bacon
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> How to Build CyanogenMod for Desire HD / Inspire 4G (codename: ace)</h2>
<div class="outline-text-2" id="text-5">
<p>
<a href="http://wiki.cyanogenmod.org/w/Build_for_ace">http://wiki.cyanogenmod.org/w/Build_for_ace</a>
</p>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Install the SDK</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>
</p>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Install the Build Packages</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">

<pre class="src src-sh">For 32-bit &amp; 64-bit systems, you<span style="color: #ffa07a;">'ll need:</span>
<span style="color: #ffa07a;">sudo apt-get install git-core gnupg flex bison gperf libsdl1.2-dev libesd0-dev libwxgtk2.8-dev squashfs-tools build-essential zip curl libncurses5-dev zlib1g-dev openjdk-6-jre openjdk-6-jdk pngcrush schedtool libxml2 xsltproc</span>

<span style="color: #ffa07a;">For 64-bit only systems, get these:</span>
<span style="color: #ffa07a;">g++-multilib lib32z1-dev lib32ncurses5-dev lib32readline-gplv2-dev gcc-4.7-multilib g++-4.5-multilib</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Create the directories</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-sh">$ mkdir -p ~/bin
$ mkdir -p ~/android/system
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Install the repo command</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-sh">$ curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo &gt; ~/bin/repo
$ chmod a+x ~/bin/repo
$ export <span style="color: #eedd82;">PATH</span>=${<span style="color: #eedd82;">PATH</span>}:~/bin
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Initialize the CyanogenMod source repository</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">

<pre class="src src-sh">$ cd ~/android/system/
$ repo init -u git://github.com/CyanogenMod/android.git -b gingerbread
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Download the source code</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">

<pre class="src src-sh">$ repo sync
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Get prebuilt Rom Manager</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">

<pre class="src src-sh">$ cd ~/android/system/vendor/cyanogen
$ ./get-rommanager
</pre>
</div>
<p>
You won't see any confirmation- just another prompt. But this should
cause the Rom Manager apps to be loaded and installed into the source
code. Once completed, this does not need to be done again.
</p>
</div>
</div>
<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Prepare the device-specific code</h3>
<div class="outline-text-3" id="text-5-8">
<p>
After the source downloads, ensure you are in the root of the source
code (cd ~/android/system), then type:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ source build/envsetup.sh
$ lunch
</pre>
</div>
<p>
You should see a list of devices, including something like
cm<sub>ace</sub>-userdebug. Select it by typing its number. It is possible that
lunch does not display your device. In that case try
</p>
<div class="org-src-container">

<pre class="src src-sh">$ lunch cm_ace-userdebug
or
$ lunch full_ace-userdebug
</pre>
</div>
<p>
If all goes well, you should see that ace-specific directories are
downloaded automatically.
</p>
</div>
</div>
<div id="outline-container-sec-5-9" class="outline-3">
<h3 id="sec-5-9"><span class="section-number-3">5.9</span> Extract proprietary blobs</h3>
<div class="outline-text-3" id="text-5-9">
<p>
Now ensure that your Desire HD / Inspire 4G is connected to your
computer via the USB cable and that you are in the
~/android/system/device/htc/ace directory (you can cd
~/android/system/device/htc/ace if necessary). Then run the
extract-files.sh script:
</p>
<div class="org-src-container">

<pre class="src src-sh">$ ./extract-files.sh
</pre>
</div>
<p>
You should see the proprietary files (aka “blobs”) get pulled from
the device and moved to the right place in the vendor directory. 
</p>

<p>
Note:
</p>

<p>
It’s important that these proprietary files are properly extracted
and moved to the <b>vendor</b> directory. Without them, CyanogenMod will
build without error, but you’ll be missing important functionality,
such as the ability to see anything!
</p>
</div>
</div>

<div id="outline-container-sec-5-10" class="outline-3">
<h3 id="sec-5-10"><span class="section-number-3">5.10</span> Turn on caching to speed up build</h3>
<div class="outline-text-3" id="text-5-10">
<div class="org-src-container">

<pre class="src src-sh">If you want to speed up subsequent builds after this one, type:
$ export <span style="color: #eedd82;">USE_CCACHE</span>=1
</pre>
</div>

<p>
Instead of typing cd ~/android/system every time you want to return
back to the root of the source code, here’s a short command that will
do it for you: croot . To use this command, as with brunch, you must
first do “. build/envsetup.sh” from ~/android/system. Notice there
is a period and space (“. ”) in that command.
</p>
</div>
</div>

<div id="outline-container-sec-5-11" class="outline-3">
<h3 id="sec-5-11"><span class="section-number-3">5.11</span> Start the build</h3>
<div class="outline-text-3" id="text-5-11">
<div class="org-src-container">

<pre class="src src-sh">$ croot
$ brunch ace
</pre>
</div>
<p>
Helpful Tip
</p>

<p>
If the build doesn't start, try lunch and choose your device from the
menu. If that doesn't work, try breakfast and choose from the menu.
The command make ace should then work.
</p>

<p>
Helpful Tip
</p>

<p>
A second, bonus tip! If you get a command not found error for croot or
brunch or lunch, be sure you’ve done the “ . build/envsetup.sh”
command in this Terminal session from the ~/android/system directory.
</p>
</div>
</div>

<div id="outline-container-sec-5-12" class="outline-3">
<h3 id="sec-5-12"><span class="section-number-3">5.12</span> If the build breaks&#x2026;</h3>
<div class="outline-text-3" id="text-5-12">
<p>
If you experience this not-enough-memory-related error&#x2026;
<code>ERROR: signapk.jar failed: return code 1make: *** [out/target/product/ace/cm_ace-ota-eng.root.zip] Error 1</code>
</p>

<p>
&#x2026;you may want to make the following change to:
<code>$ system/build/tools/releasetools/common.py</code>
<code>Change: java -Xmx2048m to java -Xmx1024m or java -Xmx512m</code>
</p>

<p>
Then start the build again (with brunch).
</p>
</div>
</div>
<div id="outline-container-sec-5-13" class="outline-3">
<h3 id="sec-5-13"><span class="section-number-3">5.13</span> Install the build</h3>
<div class="outline-text-3" id="text-5-13">
<p>
Assuming the build completed without error (it will be obvious when it
finishes), type:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">cd $OUT</span>
</pre>
</div>
<p>
in the same terminal window that you did the build. Here you’ll find
all the files that were created. The stuff that will go in <code>/system</code> is
in a folder called system. The stuff that will become your ramdisk is
in a folder called <code>root</code>. And your kernel is called&#x2026; <code>kernel</code>.
</p>

<p>
But that’s all just background info. The two files we are interested
in are (1) <code>recovery.img</code>, which contains ClockworkMod recovery, and (2)
<code>cm-[something].zip</code>, which contains CyanogenMod.
</p>
</div>
</div>

<div id="outline-container-sec-5-14" class="outline-3">
<h3 id="sec-5-14"><span class="section-number-3">5.14</span> Install CyanogenMod</h3>
</div>

<div id="outline-container-sec-5-15" class="outline-3">
<h3 id="sec-5-15"><span class="section-number-3">5.15</span> FAQ</h3>
<div class="outline-text-3" id="text-5-15">
</div><div id="outline-container-sec-5-15-1" class="outline-4">
<h4 id="sec-5-15-1"><span class="section-number-4">5.15.1</span> Duplicate device 'CyanogenMod/android<sub>device</sub><sub>htc</sub><sub>ace'</sub> found in local manifest</h4>
<div class="outline-text-4" id="text-5-15-1">
<div class="org-src-container">

<pre class="src src-sh">lunch htc_ace-eng

Device ace not found. Attempting to retrieve device repository from CyanogenMod Github (http://github.com/CyanogenMod).
Found repository: android_device_htc_ace
Duplicate device <span style="color: #ffa07a;">'CyanogenMod/android_device_htc_ace'</span> found<span style="color: #00ffff;"> in</span> local manifest
build/core/product_config.mk:196: *** _nic.PRODUCTS.[[vendor/cyanogen/products/cyanogen_anzu.mk]]: <span style="color: #ffa07a;">"device/semc/anzu/device_anzu.mk"</span> does not exist.  Stop.
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> install</h2>
<div class="outline-text-2" id="text-6">
<p>
You need to extract boot.img from the zip and flash it via fastboot. 
You need to repeat this everytime you flash new version of this rom to
ensure everything will work fluently as long as you have just basic
HTC Dev unlock.
</p>


<div class="org-src-container">

<pre class="src src-sh">fastboot flash boot boot.img
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Development by SHI</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-sh">mkdir cm10
<span style="color: #b0c4de;">cd</span> cm10/
repo init -u git://github.com/CyanogenMod/android.git -b cm-10.1
mkdir -p .repo/local_manifests
wget   -O .repo/local_manifests/cm_ace.xml
repo sync
<span style="color: #b0c4de;">cd</span> vendor/cm/
./get-prebuilts
<span style="color: #b0c4de;">cd</span> ../../
. build/envsetup.sh
lunch cm_ace-userdebug
mka bacon
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Shi Shougang</p>
<p class="date">Created: 2016-05-26 Thu 22:03</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
