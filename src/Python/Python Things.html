<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Python Things</title>
<!-- 2014-01-01 Wed 16:09 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Shi Shougang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../assets/stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python Things</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">parse argument</a></li>
<li><a href="#sec-2">Configuration file parser</a></li>
<li><a href="#sec-3">pySerial</a></li>
<li><a href="#sec-4">IDE</a>
<ul>
<li><a href="#sec-4-1">Eclipse+Pydev+PyLint</a></li>
</ul>
</li>
<li><a href="#sec-5">python Ping</a>
<ul>
<li><a href="#sec-5-1">A pure python ping implementation using raw socket.</a></li>
<li><a href="#sec-5-2">ping and traceroute</a></li>
<li><a href="#sec-5-3">A pure python ICMP ping implementation using raw sockets.</a></li>
<li><a href="#sec-5-4">Lars Strand's ping</a></li>
</ul>
</li>
<li><a href="#sec-6">Python "pseudo-inplace" file contents</a></li>
<li><a href="#sec-7">Python send simple Email</a></li>
<li><a href="#sec-8">compare "version-style" strings</a></li>
<li><a href="#sec-9">windows install pip</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">parse argument</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="http://docs.python.org/2/library/argparse.html">http://docs.python.org/2/library/argparse.html</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #00ffff;">import</span> argparse

<span style="color: #ffebcd; background-color: #2f4f4f;">parser</span> = argparse.ArgumentParser(<span style="color: #ffebcd; background-color: #2f4f4f;">description</span>=<span style="color: #ffa07a;">'Process some integers.'</span>)
parser.add_argument(<span style="color: #ffa07a;">'integers'</span>, <span style="color: #ffebcd; background-color: #2f4f4f;">metavar</span>=<span style="color: #ffa07a;">'N'</span>, <span style="color: #ffebcd; background-color: #2f4f4f;">type</span>=int, <span style="color: #ffebcd; background-color: #2f4f4f;">nargs</span>=<span style="color: #ffa07a;">'+'</span>,
                   <span style="color: #ffebcd; background-color: #2f4f4f;">help</span>=<span style="color: #ffa07a;">'an integer for the accumulator'</span>)
parser.add_argument(<span style="color: #ffa07a;">'--sum'</span>, <span style="color: #ffebcd; background-color: #2f4f4f;">dest</span>=<span style="color: #ffa07a;">'accumulate'</span>, <span style="color: #ffebcd; background-color: #2f4f4f;">action</span>=<span style="color: #ffa07a;">'store_const'</span>,
                   <span style="color: #ffebcd; background-color: #2f4f4f;">const</span>=sum, <span style="color: #ffebcd; background-color: #2f4f4f;">default</span>=max,
                   <span style="color: #ffebcd; background-color: #2f4f4f;">help</span>=<span style="color: #ffa07a;">'sum the integers (default: find the max)'</span>)

<span style="color: #ffebcd; background-color: #2f4f4f;">args</span> = parser.parse_args()
<span style="color: #b0c4de;">print</span> args.accumulate(args.integers)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">$ prog.py 1 2 3 4
4

$ prog.py 1 2 3 4 --sum
10
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Configuration file parser</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="http://docs.python.org/2/library/configparser.html">http://docs.python.org/2/library/configparser.html</a>
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">pySerial</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install python-pip
pip install mechanize
pip install pyserial
</pre>
</div>

<p>
<a href="http://pyserial.sourceforge.net/pyserial.html#installation">http://pyserial.sourceforge.net/pyserial.html#installation</a>
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">IDE</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Eclipse+Pydev+PyLint</h3>
<div class="outline-text-3" id="text-4-1">
</div><ul class="org-ul"><li>PyLint can be used with PyDev<br  /><div class="outline-text-4" id="text-4-1-1">
<p>
<a href="http://pydev.org/manual_adv_pylint.html">http://pydev.org/manual_adv_pylint.html</a>
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">python Ping</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">A pure python ping implementation using raw socket.</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<a href="http://www.g-loaded.eu/2009/10/30/python-ping/">http://www.g-loaded.eu/2009/10/30/python-ping/</a>
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/usr/bin/env python</span>
<span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    A pure python ping implementation using raw socket.</span>


<span style="color: #ffa07a;">    Note that ICMP messages can only be sent from processes running as root.</span>


<span style="color: #ffa07a;">    Derived from ping.c distributed in Linux's netkit. That code is</span>
<span style="color: #ffa07a;">    copyright (c) 1989 by The Regents of the University of California.</span>
<span style="color: #ffa07a;">    That code is in turn derived from code written by Mike Muuss of the</span>
<span style="color: #ffa07a;">    US Army Ballistic Research Laboratory in December, 1983 and</span>
<span style="color: #ffa07a;">    placed in the public domain. They have my thanks.</span>

<span style="color: #ffa07a;">    Bugs are naturally mine. I'd be glad to hear about them. There are</span>
<span style="color: #ffa07a;">    certainly word - size dependenceies here.</span>

<span style="color: #ffa07a;">    Copyright (c) Matthew Dixon Cowles, &lt;<a href="http://www.visi.com/~mdc/">http://www.visi.com/~mdc/</a>&gt;.</span>
<span style="color: #ffa07a;">    Distributable under the terms of the GNU General Public License</span>
<span style="color: #ffa07a;">    version 2. Provided with no warranties of any sort.</span>

<span style="color: #ffa07a;">    Original Version from Matthew Dixon Cowles:</span>
<span style="color: #ffa07a;">      -&gt; ftp://ftp.visi.com/users/mdc/ping.py</span>

<span style="color: #ffa07a;">    Rewrite by Jens Diemer:</span>
<span style="color: #ffa07a;">      -&gt; http://www.python-forum.de/post-69122.html#69122</span>

<span style="color: #ffa07a;">    Rewrite by George Notaras:</span>
<span style="color: #ffa07a;">      -&gt; http://www.g-loaded.eu/2009/10/30/python-ping/</span>

<span style="color: #ffa07a;">    Revision history</span>
<span style="color: #ffa07a;">    ~~~~~~~~~~~~~~~~</span>

<span style="color: #ffa07a;">    November 8, 2009</span>
<span style="color: #ffa07a;">    ----------------</span>
<span style="color: #ffa07a;">    Improved compatibility with GNU/Linux systems.</span>

<span style="color: #ffa07a;">    Fixes by:</span>
<span style="color: #ffa07a;">     * George Notaras -- http://www.g-loaded.eu</span>
<span style="color: #ffa07a;">    Reported by:</span>
<span style="color: #ffa07a;">     * Chris Hallman -- http://cdhallman.blogspot.com</span>

<span style="color: #ffa07a;">    Changes in this release:</span>
<span style="color: #ffa07a;">     - Re-use time.time() instead of time.clock(). The 2007 implementation</span>
<span style="color: #ffa07a;">       worked only under Microsoft Windows. Failed on GNU/Linux.</span>
<span style="color: #ffa07a;">       time.clock() behaves differently under the two OSes[1].</span>

<span style="color: #ffa07a;">    [1] http://docs.python.org/library/time.html#time.clock</span>

<span style="color: #ffa07a;">    May 30, 2007</span>
<span style="color: #ffa07a;">    ------------</span>
<span style="color: #ffa07a;">    little rewrite by Jens Diemer:</span>
<span style="color: #ffa07a;">     -  change socket asterisk import to a normal import</span>
<span style="color: #ffa07a;">     -  replace time.time() with time.clock()</span>
<span style="color: #ffa07a;">     -  delete "return None" (or change to "return" only)</span>
<span style="color: #ffa07a;">     -  in checksum() rename "str" to "source_string"</span>

<span style="color: #ffa07a;">    November 22, 1997</span>
<span style="color: #ffa07a;">    -----------------</span>
<span style="color: #ffa07a;">    Initial hack. Doesn't do much, but rather than try to guess</span>
<span style="color: #ffa07a;">    what features I (or others) will want in the future, I've only</span>
<span style="color: #ffa07a;">    put in what I need now.</span>

<span style="color: #ffa07a;">    December 16, 1997</span>
<span style="color: #ffa07a;">    -----------------</span>
<span style="color: #ffa07a;">    For some reason, the checksum bytes are in the wrong order when</span>
<span style="color: #ffa07a;">    this is run under Solaris 2.X for SPARC but it works right under</span>
<span style="color: #ffa07a;">    Linux x86. Since I don't know just what's wrong, I'll swap the</span>
<span style="color: #ffa07a;">    bytes always and then do an htons().</span>

<span style="color: #ffa07a;">    December 4, 2000</span>
<span style="color: #ffa07a;">    ----------------</span>
<span style="color: #ffa07a;">    Changed the struct.pack() calls to pack the checksum and ID as</span>
<span style="color: #ffa07a;">    unsigned. My thanks to Jerome Poincheval for the fix.</span>


<span style="color: #ffa07a;">    Last commit info:</span>
<span style="color: #ffa07a;">    ~~~~~~~~~~~~~~~~~</span>
<span style="color: #ffa07a;">    $LastChangedDate: $</span>
<span style="color: #ffa07a;">    $Rev: $</span>
<span style="color: #ffa07a;">    $Author: $</span>
<span style="color: #ffa07a;">"""</span>


<span style="color: #00ffff;">import</span> os, sys, socket, struct, select, time

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">From /usr/include/linux/icmp.h; your milage may vary.</span>
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_ECHO_REQUEST</span> = 8 <span style="color: #ff7f24;"># Seems to be the same on Solaris.</span>


<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">checksum</span>(source_string):
    <span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    I'm not too confident that this is right but testing seems</span>
<span style="color: #ffa07a;">    to suggest that it gives the same answers as in_cksum in ping.c</span>
<span style="color: #ffa07a;">    """</span>
    <span style="color: #b0c4de;">sum</span> = 0
    <span style="color: #ffebcd; background-color: #2f4f4f;">countTo</span> = (<span style="color: #b0c4de;">len</span>(source_string)/2)*2
    <span style="color: #ffebcd; background-color: #2f4f4f;">count</span> = 0
    <span style="color: #00ffff;">while</span> count&lt;countTo:
        <span style="color: #ffebcd; background-color: #2f4f4f;">thisVal</span> = <span style="color: #b0c4de;">ord</span>(source_string[count + 1])*256 + <span style="color: #b0c4de;">ord</span>(source_string[count])
        <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> + thisVal
        <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> &amp; 0xffffffff <span style="color: #ff7f24;"># Necessary?</span>
        <span style="color: #ffebcd; background-color: #2f4f4f;">count</span> = count + 2

    <span style="color: #00ffff;">if</span> countTo&lt;<span style="color: #b0c4de;">len</span>(source_string):
        <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> + <span style="color: #b0c4de;">ord</span>(source_string[<span style="color: #b0c4de;">len</span>(source_string) - 1])
        <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> &amp; 0xffffffff <span style="color: #ff7f24;"># Necessary?</span>

    <span style="color: #b0c4de;">sum</span> = (<span style="color: #b0c4de;">sum</span> &gt;&gt; 16)  +  (<span style="color: #b0c4de;">sum</span> &amp; 0xffff)
    <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> + (<span style="color: #b0c4de;">sum</span> &gt;&gt; 16)
    <span style="color: #ffebcd; background-color: #2f4f4f;">answer</span> = ~<span style="color: #b0c4de;">sum</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">answer</span> = answer &amp; 0xffff

    <span style="color: #ff7f24;"># Swap bytes. Bugger me if I know why.</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">answer</span> = answer &gt;&gt; 8 | (answer &lt;&lt; 8 &amp; 0xff00)

    <span style="color: #00ffff;">return</span> answer


<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">receive_one_ping</span>(my_socket, ID, timeout):
    <span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    receive the ping from the socket.</span>
<span style="color: #ffa07a;">    """</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">timeLeft</span> = timeout
    <span style="color: #00ffff;">while</span> <span style="color: #00ffff;">True</span>:
        <span style="color: #ffebcd; background-color: #2f4f4f;">startedSelect</span> = time.time()
        <span style="color: #ffebcd; background-color: #2f4f4f;">whatReady</span> = select.select([my_socket], [], [], timeLeft)
        <span style="color: #ffebcd; background-color: #2f4f4f;">howLongInSelect</span> = (time.time() - startedSelect)
        <span style="color: #00ffff;">if</span> whatReady[0] == []: <span style="color: #ff7f24;"># Timeout</span>
            <span style="color: #00ffff;">return</span>

        <span style="color: #ffebcd; background-color: #2f4f4f;">timeReceived</span> = time.time()
        recPacket, <span style="color: #ffebcd; background-color: #2f4f4f;">addr</span> = my_socket.recvfrom(1024)
        <span style="color: #ffebcd; background-color: #2f4f4f;">icmpHeader</span> = recPacket[20:28]
        type, code, checksum, packetID, <span style="color: #ffebcd; background-color: #2f4f4f;">sequence</span> = struct.unpack(
            <span style="color: #ffa07a;">"bbHHh"</span>, icmpHeader
        )
        <span style="color: #00ffff;">if</span> packetID == ID:
            <span style="color: #ffebcd; background-color: #2f4f4f;">bytesInDouble</span> = struct.calcsize(<span style="color: #ffa07a;">"d"</span>)
            <span style="color: #ffebcd; background-color: #2f4f4f;">timeSent</span> = struct.unpack(<span style="color: #ffa07a;">"d"</span>, recPacket[28:28 + bytesInDouble])[0]
            <span style="color: #00ffff;">return</span> timeReceived - timeSent

        <span style="color: #ffebcd; background-color: #2f4f4f;">timeLeft</span> = timeLeft - howLongInSelect
        <span style="color: #00ffff;">if</span> timeLeft &lt;= 0:
            <span style="color: #00ffff;">return</span>


<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">send_one_ping</span>(my_socket, dest_addr, ID):
    <span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    Send one ping to the given &gt;dest_addr&lt;.</span>
<span style="color: #ffa07a;">    """</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">dest_addr</span>  =  socket.gethostbyname(dest_addr)

    <span style="color: #ff7f24;"># Header is type (8), code (8), checksum (16), id (16), sequence (16)</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">my_checksum</span> = 0

    <span style="color: #ff7f24;"># Make a dummy heder with a 0 checksum.</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(<span style="color: #ffa07a;">"bbHHh"</span>, ICMP_ECHO_REQUEST, 0, my_checksum, ID, 1)
    <span style="color: #ffebcd; background-color: #2f4f4f;">bytesInDouble</span> = struct.calcsize(<span style="color: #ffa07a;">"d"</span>)
    <span style="color: #ffebcd; background-color: #2f4f4f;">data</span> = (192 - bytesInDouble) * <span style="color: #ffa07a;">"Q"</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">data</span> = struct.pack(<span style="color: #ffa07a;">"d"</span>, time.time()) + data

    <span style="color: #ff7f24;"># Calculate the checksum on the data and the dummy header.</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">my_checksum</span> = checksum(header + data)

    <span style="color: #ff7f24;"># Now that we have the right checksum, we put that in. It's just easier</span>
    <span style="color: #ff7f24;"># to make up a new header than to stuff it into the dummy.</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(
        <span style="color: #ffa07a;">"bbHHh"</span>, ICMP_ECHO_REQUEST, 0, socket.htons(my_checksum), ID, 1
    )
    <span style="color: #ffebcd; background-color: #2f4f4f;">packet</span> = header + data
    my_socket.sendto(packet, (dest_addr, 1)) <span style="color: #ff7f24;"># Don't know about the 1</span>


<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">do_one</span>(dest_addr, timeout):
    <span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    Returns either the delay (in seconds) or none on timeout.</span>
<span style="color: #ffa07a;">    """</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">icmp</span> = socket.getprotobyname(<span style="color: #ffa07a;">"icmp"</span>)
    <span style="color: #00ffff;">try:</span>
        <span style="color: #ffebcd; background-color: #2f4f4f;">my_socket</span> = socket.socket(socket.AF_INET, socket.SOCK_RAW, icmp)
    <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">socket.error</span>, (errno, msg):
        <span style="color: #00ffff;">if</span> errno == 1:
            <span style="color: #ff7f24;"># Operation not permitted</span>
            <span style="color: #ffebcd; background-color: #2f4f4f;">msg</span> = msg + (
                <span style="color: #ffa07a;">" - Note that ICMP messages can only be sent from processes"</span>
                <span style="color: #ffa07a;">" running as root."</span>
            )
            <span style="color: #00ffff;">raise</span> <span style="color: #b0c4de;">socket.error</span>(msg)
        <span style="color: #00ffff;">raise</span> <span style="color: #ff7f24;"># raise the original error</span>

    <span style="color: #ffebcd; background-color: #2f4f4f;">my_ID</span> = os.getpid() &amp; 0xFFFF

    send_one_ping(my_socket, dest_addr, my_ID)
    <span style="color: #ffebcd; background-color: #2f4f4f;">delay</span> = receive_one_ping(my_socket, my_ID, timeout)

    my_socket.close()
    <span style="color: #00ffff;">return</span> delay


<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">verbose_ping</span>(dest_addr, <span style="color: #ffebcd; background-color: #2f4f4f;">timeout</span> = 2, <span style="color: #ffebcd; background-color: #2f4f4f;">count</span> = 4):
    <span style="color: #ffa07a;">"""</span>
<span style="color: #ffa07a;">    Send &gt;count&lt; ping to &gt;dest_addr&lt; with the given &gt;timeout&lt; and display</span>
<span style="color: #ffa07a;">    the result.</span>
<span style="color: #ffa07a;">    """</span>
    <span style="color: #00ffff;">for</span> i <span style="color: #00ffff;">in</span> <span style="color: #b0c4de;">xrange</span>(count):
        <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"ping %s..."</span> % dest_addr,
        <span style="color: #00ffff;">try:</span>
            <span style="color: #ffebcd; background-color: #2f4f4f;">delay</span>  =  do_one(dest_addr, timeout)
        <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">socket.gaierror</span>, e:
            <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"failed. (socket error: '%s')"</span> % e[1]
            <span style="color: #00ffff;">break</span>

        <span style="color: #00ffff;">if</span> delay  ==  <span style="color: #00ffff;">None</span>:
            <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"failed. (timeout within %ssec.)"</span> % timeout
        <span style="color: #00ffff;">else:</span>
            <span style="color: #ffebcd; background-color: #2f4f4f;">delay</span>  =  delay * 1000
            <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"get ping in %0.4fms"</span> % delay
    <span style="color: #b0c4de;">print</span>


<span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">__name__</span> == <span style="color: #ffa07a;">'__main__'</span>:
    verbose_ping(<span style="color: #ffa07a;">"heise.de"</span>)
    verbose_ping(<span style="color: #ffa07a;">"google.com"</span>)
    verbose_ping(<span style="color: #ffa07a;">"a-test-url-taht-is-not-available.com"</span>)
    verbose_ping(<span style="color: #ffa07a;">"192.168.1.1"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">ping and traceroute</h3>
<div class="outline-text-3" id="text-5-2">
<p>
<a href="http://www.python.org/~jeremy/python.html">http://www.python.org/~jeremy/python.html</a>
</p>

<p>
ping.tar.gz
</p>

<p>
Some simple-minded code for manipulating raw IP, ICMP, and UDP
packets. They allow you to write ping and traceroute completely in
Python; the code is smaller and simpler than the corresponding C
versions (e.g. <a href="http://www.opensource.apple.com/source/network_cmds/network_cmds-307.0.1/traceroute.tproj/traceroute.c">traceroute.c</a>). The code was written for Python 1.4; it
should be updated to use the new features of the struct module in 1.5.
</p>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">A pure python ICMP ping implementation using raw sockets.</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<a href="https://github.com/shishougang/python_ping">https://github.com/shishougang/python_ping</a>
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">Lars Strand's ping</h3>
<div class="outline-text-3" id="text-5-4">
<p>
ping.py uses the ICMP protocol's mandatory ECHO<sub>REQUEST</sub> 
datagram to elicit an ICMP ECHO<sub>RESPONSE</sub> from a 
host or gateway.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/usr/bin/env python </span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">-*- coding: iso-8859-1 -*- </span>
<span style="color: #ffa07a;">"""ping.py </span>

<span style="color: #ffa07a;">ping.py uses the ICMP protocol's mandatory ECHO_REQUEST </span>
<span style="color: #ffa07a;">datagram to elicit an ICMP ECHO_RESPONSE from a </span>
<span style="color: #ffa07a;">host or gateway. </span>

<span style="color: #ffa07a;">Copyright (C) 2004 - Lars Strand &lt;lars strand at gnist org&gt; </span>

<span style="color: #ffa07a;">This program is free software; you can redistribute it and/or </span>
<span style="color: #ffa07a;">modify it under the terms of the GNU General Public License </span>
<span style="color: #ffa07a;">as published by the Free Software Foundation; either version 2 </span>
<span style="color: #ffa07a;">of the License, or (at your option) any later version. </span>

<span style="color: #ffa07a;">This program is distributed in the hope that it will be useful, </span>
<span style="color: #ffa07a;">but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span style="color: #ffa07a;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the </span>
<span style="color: #ffa07a;">GNU General Public License for more details. </span>

<span style="color: #ffa07a;">You should have received a copy of the GNU General Public License </span>
<span style="color: #ffa07a;">along with this program; if not, write to the Free Software </span>
<span style="color: #ffa07a;">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA. </span>

<span style="color: #ffa07a;">Must be running as root, or write a suid-wrapper. Since newer *nix </span>
<span style="color: #ffa07a;">variants, the kernel ignores the set[ug]id flags on #! scripts for </span>
<span style="color: #ffa07a;">security reasons </span>

<span style="color: #ffa07a;">RFC792, echo/reply message: </span>

<span style="color: #ffa07a;"> 0                   1                   2                   3 </span>
<span style="color: #ffa07a;"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 </span>
<span style="color: #ffa07a;">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ </span>
<span style="color: #ffa07a;">|     Type      |     Code      |          Checksum             | </span>
<span style="color: #ffa07a;">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ </span>
<span style="color: #ffa07a;">|           Identifier          |        Sequence Number        | </span>
<span style="color: #ffa07a;">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ </span>
<span style="color: #ffa07a;">|     Data ... </span>
<span style="color: #ffa07a;">+-+-+-+-+- </span>


<span style="color: #ffa07a;">TODO</span><span style="color: #ffa07a;">: </span>
<span style="color: #ffa07a;">- do not create socket inside 'while' (but if not: ipv6 won't work) </span>
<span style="color: #ffa07a;">- add support for broadcast/multicast </span>
<span style="color: #ffa07a;">- add support for own payload string </span>

<span style="color: #ffa07a;">CHANGELOG: </span>
<span style="color: #ffa07a;">DONE --&gt; bugfix from Filip Van Raemdonck mechanix debian org </span>
<span style="color: #ffa07a;">DONE --&gt; add more support for modules (raise instead of sys.exit) </span>
<span style="color: #ffa07a;">DONE --&gt; locale func names </span>
<span style="color: #ffa07a;">DONE --&gt; package def </span>
<span style="color: #ffa07a;">DONE --&gt; some code cleanup </span>

<span style="color: #ffa07a;">"""</span> 

<span style="color: #00ffff;">import</span> sys 
<span style="color: #00ffff;">import</span> os 
<span style="color: #00ffff;">import</span> struct 
<span style="color: #00ffff;">import</span> array 
<span style="color: #00ffff;">import</span> time 
<span style="color: #00ffff;">import</span> select 
<span style="color: #00ffff;">import</span> binascii 
<span style="color: #00ffff;">import</span> math 
<span style="color: #00ffff;">import</span> getopt 
<span style="color: #00ffff;">import</span> string 
<span style="color: #00ffff;">import</span> socket 

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">total size of data (payload) </span>
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_DATA_STR</span> = 56  

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">initial values of header variables </span>
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_TYPE</span> = 8 
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_TYPE_IP6</span> = 128 
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_CODE</span> = 0 
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_CHECKSUM</span> = 0 
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_ID</span> = 0 
<span style="color: #ffebcd; background-color: #2f4f4f;">ICMP_SEQ_NR</span> = 0 

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Package definitions. </span>
<span style="color: #ffebcd; background-color: #2f4f4f;">__program__</span>   = <span style="color: #ffa07a;">'ping'</span> 
<span style="color: #ffebcd; background-color: #2f4f4f;">__version__</span>   = <span style="color: #ffa07a;">'0.5a'</span> 
<span style="color: #ffebcd; background-color: #2f4f4f;">__date__</span>      = <span style="color: #ffa07a;">'2004/15/12'</span> 
<span style="color: #ffebcd; background-color: #2f4f4f;">__author__</span>    = <span style="color: #ffa07a;">'Lars Strand &lt;lars at unik no&gt;'</span> 
<span style="color: #ffebcd; background-color: #2f4f4f;">__licence__</span>   = <span style="color: #ffa07a;">'GPL'</span> 
<span style="color: #ffebcd; background-color: #2f4f4f;">__copyright__</span> = <span style="color: #ffa07a;">'Copyright (C) 2004 Lars Strand'</span> 

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">_construct</span>(id, size, ipv6): 
   <span style="color: #ffa07a;">"""Constructs a ICMP echo packet of variable size </span>
<span style="color: #ffa07a;">   """</span> 

   <span style="color: #ff7f24;"># size must be big enough to contain time sent </span>
   <span style="color: #00ffff;">if</span> size &lt; <span style="color: #b0c4de;">int</span>(struct.calcsize(<span style="color: #ffa07a;">"d"</span>)): 
       _error(<span style="color: #ffa07a;">"packetsize to small, must be at least %d"</span> % <span style="color: #b0c4de;">int</span>(struct.calcsize(<span style="color: #ffa07a;">"d"</span>))) 

   <span style="color: #ff7f24;"># construct header </span>
   <span style="color: #00ffff;">if</span> ipv6: 
       <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(<span style="color: #ffa07a;">'BbHHh'</span>, ICMP_TYPE_IP6, ICMP_CODE, ICMP_CHECKSUM,
                            ICMP_ID, ICMP_SEQ_NR+id) 
   <span style="color: #00ffff;">else:</span> 
       <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(<span style="color: #ffa07a;">'bbHHh'</span>, ICMP_TYPE, ICMP_CODE, ICMP_CHECKSUM,
                            ICMP_ID, ICMP_SEQ_NR+id) 

   <span style="color: #ff7f24;"># if size big enough, embed this payload </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">load</span> = <span style="color: #ffa07a;">"-- IF YOU ARE READING THIS YOU ARE A NERD! --"</span> 

   <span style="color: #ff7f24;"># space for time </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">size</span> -= struct.calcsize(<span style="color: #ffa07a;">"d"</span>) 

   <span style="color: #ff7f24;"># construct payload based on size, may be omitted :) </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">rest</span> = <span style="color: #ffa07a;">""</span> 
   <span style="color: #00ffff;">if</span> size &gt; <span style="color: #b0c4de;">len</span>(load): 
       <span style="color: #ffebcd; background-color: #2f4f4f;">rest</span> = load 
       <span style="color: #ffebcd; background-color: #2f4f4f;">size</span> -= <span style="color: #b0c4de;">len</span>(load) 

   <span style="color: #ff7f24;"># pad the rest of payload </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">rest</span> += size * <span style="color: #ffa07a;">"X"</span> 

   <span style="color: #ff7f24;"># pack </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">data</span> = struct.pack(<span style="color: #ffa07a;">"d"</span>, time.time()) + rest 
   <span style="color: #ffebcd; background-color: #2f4f4f;">packet</span> = header + data          <span style="color: #ff7f24;"># ping packet without checksum </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">checksum</span> = _in_cksum(packet)    <span style="color: #ff7f24;"># make checksum </span>

   <span style="color: #ff7f24;"># construct header with correct checksum </span>
   <span style="color: #00ffff;">if</span> ipv6: 
       <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(<span style="color: #ffa07a;">'BbHHh'</span>, ICMP_TYPE_IP6, ICMP_CODE, checksum, 
                            ICMP_ID, ICMP_SEQ_NR+id) 
   <span style="color: #00ffff;">else:</span> 
       <span style="color: #ffebcd; background-color: #2f4f4f;">header</span> = struct.pack(<span style="color: #ffa07a;">'bbHHh'</span>, ICMP_TYPE, ICMP_CODE, checksum, ICMP_ID, 
                            ICMP_SEQ_NR+id) 

   <span style="color: #ff7f24;"># ping packet *with* checksum </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">packet</span> = header + data 

   <span style="color: #ff7f24;"># a perfectly formatted ICMP echo packet </span>
   <span style="color: #00ffff;">return</span> packet 

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">_in_cksum</span>(packet): 
   <span style="color: #ffa07a;">"""THE RFC792 states: 'The 16 bit one's complement of </span>
<span style="color: #ffa07a;">   the one's complement sum of all 16 bit words in the header.' </span>

<span style="color: #ffa07a;">   Generates a checksum of a (ICMP) packet. Based on in_chksum found </span>
<span style="color: #ffa07a;">   in ping.c on FreeBSD. </span>
<span style="color: #ffa07a;">   """</span> 

   <span style="color: #ff7f24;"># add byte if not dividable by 2 </span>
   <span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">len</span>(packet) &amp; 1:              
       <span style="color: #ffebcd; background-color: #2f4f4f;">packet</span> = packet + <span style="color: #ffa07a;">'\0'</span> 

   <span style="color: #ff7f24;"># split into 16-bit word and insert into a binary array </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">words</span> = array.array(<span style="color: #ffa07a;">'h'</span>, packet) 
   <span style="color: #b0c4de;">sum</span> = 0 

   <span style="color: #ff7f24;"># perform ones complement arithmetic on 16-bit words </span>
   <span style="color: #00ffff;">for</span> word <span style="color: #00ffff;">in</span> words: 
       <span style="color: #b0c4de;">sum</span> += (word &amp; 0xffff) 

   <span style="color: #ffebcd; background-color: #2f4f4f;">hi</span> = <span style="color: #b0c4de;">sum</span> &gt;&gt; 16 
   <span style="color: #ffebcd; background-color: #2f4f4f;">lo</span> = <span style="color: #b0c4de;">sum</span> &amp; 0xffff 
   <span style="color: #b0c4de;">sum</span> = hi + lo 
   <span style="color: #b0c4de;">sum</span> = <span style="color: #b0c4de;">sum</span> + (<span style="color: #b0c4de;">sum</span> &gt;&gt; 16) 

   <span style="color: #00ffff;">return</span> (~sum) &amp; 0xffff <span style="color: #ff7f24;"># return ones complement </span>

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">pingNode</span>(<span style="color: #ffebcd; background-color: #2f4f4f;">alive</span>=0, <span style="color: #ffebcd; background-color: #2f4f4f;">timeout</span>=1.0, <span style="color: #ffebcd; background-color: #2f4f4f;">ipv6</span>=0, <span style="color: #ffebcd; background-color: #2f4f4f;">number</span>=sys.maxint, <span style="color: #ffebcd; background-color: #2f4f4f;">node</span>=<span style="color: #00ffff;">None</span>, 
            <span style="color: #ffebcd; background-color: #2f4f4f;">flood</span>=0, <span style="color: #ffebcd; background-color: #2f4f4f;">size</span>=ICMP_DATA_STR): 
   <span style="color: #ffa07a;">"""Pings a node based on input given to the function. </span>
<span style="color: #ffa07a;">   """</span> 

   <span style="color: #ff7f24;"># if no node, exit </span>
   <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> node: 
       _error(<span style="color: #ffa07a;">""</span>) 

   <span style="color: #ff7f24;"># if not a valid host, exit </span>
   <span style="color: #00ffff;">if</span> ipv6: 
       <span style="color: #00ffff;">if</span> socket.has_ipv6: 
           <span style="color: #00ffff;">try:</span> 
               info, <span style="color: #ffebcd; background-color: #2f4f4f;">port</span> = socket.getaddrinfo(node, <span style="color: #00ffff;">None</span>) 
               <span style="color: #ffebcd; background-color: #2f4f4f;">host</span> = info[4][0] 
               <span style="color: #ff7f24;"># do not print ipv6 twice if ipv6 address given as node </span>
               <span style="color: #00ffff;">if</span> host == node: 
                   <span style="color: #ffebcd; background-color: #2f4f4f;">noPrintIPv6adr</span> = 1 
           <span style="color: #00ffff;">except:</span> 
               _error(<span style="color: #ffa07a;">"cannot resolve %s: Unknow host"</span> % node) 
       <span style="color: #00ffff;">else:</span> 
           _error(<span style="color: #ffa07a;">"No support for IPv6 on this plattform"</span>) 
   <span style="color: #00ffff;">else:</span>    <span style="color: #ff7f24;"># IPv4 </span>
       <span style="color: #00ffff;">try:</span> 
           <span style="color: #ffebcd; background-color: #2f4f4f;">host</span> = socket.gethostbyname(node) 
       <span style="color: #00ffff;">except:</span> 
           _error(<span style="color: #ffa07a;">"cannot resolve %s: Unknow host"</span> % node) 

   <span style="color: #ff7f24;"># trying to ping a network? </span>
   <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> ipv6: 
       <span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">int</span>(string.split(host, <span style="color: #ffa07a;">"."</span>)[-1]) == 0: 
           _error(<span style="color: #ffa07a;">"no support for network ping"</span>) 

   <span style="color: #ff7f24;"># do some sanity check </span>
   <span style="color: #00ffff;">if</span> number == 0: 
       _error(<span style="color: #ffa07a;">"invalid count of packets to transmit: '%s'"</span> % <span style="color: #b0c4de;">str</span>(a)) 
   <span style="color: #00ffff;">if</span> alive: 
       <span style="color: #ffebcd; background-color: #2f4f4f;">number</span> = 1 

   <span style="color: #ff7f24;"># Send the ping(s) </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">start</span> = 1; <span style="color: #ffebcd; background-color: #2f4f4f;">mint</span> = 999; <span style="color: #ffebcd; background-color: #2f4f4f;">maxt</span> = 0.0; <span style="color: #ffebcd; background-color: #2f4f4f;">avg</span> = 0.0 
   <span style="color: #ffebcd; background-color: #2f4f4f;">lost</span> = 0; <span style="color: #ffebcd; background-color: #2f4f4f;">tsum</span> = 0.0; <span style="color: #ffebcd; background-color: #2f4f4f;">tsumsq</span> = 0.0 

   <span style="color: #ff7f24;"># tell the user what we do </span>
   <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> alive: 
       <span style="color: #00ffff;">if</span> ipv6: 
           <span style="color: #ff7f24;"># do not print the ipv6 twice if ip adress given as node </span>
           <span style="color: #ff7f24;"># (it can be to long in term window) </span>
           <span style="color: #00ffff;">if</span> noPrintIPv6adr == 1: 
               <span style="color: #ff7f24;"># add 40 (header) + 8 (icmp header) + payload </span>
               <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"PING %s : %d data bytes (40+8+%d)"</span> % (<span style="color: #b0c4de;">str</span>(node), 
                                                            40+8+size, size) 
           <span style="color: #00ffff;">else:</span> 
               <span style="color: #ff7f24;"># add 40 (header) + 8 (icmp header) + payload </span>
               <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"PING %s (%s): %d data bytes (40+8+%d)"</span> % (<span style="color: #b0c4de;">str</span>(node), 
                                                                <span style="color: #b0c4de;">str</span>(host), 40+8+size, size) 
       <span style="color: #00ffff;">else:</span> 
           <span style="color: #ff7f24;"># add 20 (header) + 8 (icmp header) + payload </span>
           <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"PING %s (%s): %d data bytes (20+8+%d)"</span> % (<span style="color: #b0c4de;">str</span>(node), <span style="color: #b0c4de;">str</span>(host), 
                                                            20+8+size, size) 

   <span style="color: #ff7f24;"># trap ctrl-d and ctrl-c </span>
   <span style="color: #00ffff;">try:</span> 

       <span style="color: #ff7f24;"># send the number of ping packets as given </span>
       <span style="color: #00ffff;">while</span> start &lt;= number: 
           <span style="color: #ffebcd; background-color: #2f4f4f;">lost</span> += 1 <span style="color: #ff7f24;"># in case user hit ctrl-c </span>

           <span style="color: #ff7f24;"># create the IPv6/IPv4 socket </span>
           <span style="color: #00ffff;">if</span> ipv6: 
               <span style="color: #ff7f24;"># can not create a raw socket if not root or setuid to root </span>
               <span style="color: #00ffff;">try:</span> 
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pingSocket</span> = socket.socket(socket.AF_INET6, socket.SOCK_RAW, 
                                              socket.getprotobyname(<span style="color: #ffa07a;">"ipv6-icmp"</span>)) 
               <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">socket.error</span>, e: 
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"socket error: %s"</span> % e 
                   _error(<span style="color: #ffa07a;">"You must be root (uses raw sockets)"</span> % os.path.basename(sys.argv[0])) 

           <span style="color: #ff7f24;"># IPv4 </span>
           <span style="color: #00ffff;">else:</span> 
               <span style="color: #ff7f24;"># can not create a raw socket if not root or setuid to root </span>
               <span style="color: #00ffff;">try:</span> 
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pingSocket</span> = socket.socket(socket.AF_INET, socket.SOCK_RAW, 
                                              socket.getprotobyname(<span style="color: #ffa07a;">"icmp"</span>)) 
               <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">socket.error</span>, e: 
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"socket error: %s"</span> % e 
                   _error(<span style="color: #ffa07a;">"You must be root (%s uses raw sockets)"</span> % os.path.basename(sys.argv[0])) 

           <span style="color: #ffebcd; background-color: #2f4f4f;">packet</span> = _construct(start, size, ipv6) <span style="color: #ff7f24;"># make a ping packet </span>

           <span style="color: #ff7f24;"># send the ping </span>
           <span style="color: #00ffff;">try:</span> 
               pingSocket.sendto(packet,(node,1)) 
           <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">socket.error</span>, e: 
               _error(<span style="color: #ffa07a;">"socket error: %s"</span> % e) 

           <span style="color: #ff7f24;"># reset values </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">pong</span> = <span style="color: #ffa07a;">""</span>; <span style="color: #ffebcd; background-color: #2f4f4f;">iwtd</span> = [] 

           <span style="color: #ff7f24;"># wait until there is data in the socket </span>
           <span style="color: #00ffff;">while</span> 1: 
               <span style="color: #ff7f24;"># input, output, exceptional conditions </span>
               iwtd, owtd, <span style="color: #ffebcd; background-color: #2f4f4f;">ewtd</span> = select.select([pingSocket], [], [], timeout) 
               <span style="color: #00ffff;">break</span> <span style="color: #ff7f24;"># no data and timout occurred </span>

           <span style="color: #ff7f24;"># data on socket - this means we have an answer </span>
           <span style="color: #00ffff;">if</span> iwtd:  <span style="color: #ff7f24;"># ok, data on socket </span>
               <span style="color: #ffebcd; background-color: #2f4f4f;">endtime</span> = time.time()  <span style="color: #ff7f24;"># time packet received </span>
               <span style="color: #ff7f24;"># read data (we only need the header) </span>
               pong, <span style="color: #ffebcd; background-color: #2f4f4f;">address</span> = pingSocket.recvfrom(size+48) 
               <span style="color: #ffebcd; background-color: #2f4f4f;">lost</span> -= 1 <span style="color: #ff7f24;"># in case user hit ctrl-c </span>

               <span style="color: #ff7f24;"># examine packet </span>
               <span style="color: #ff7f24;"># fetch TTL from IP header </span>
               <span style="color: #00ffff;">if</span> ipv6: 
                   <span style="color: #ff7f24;"># since IPv6 header and any extension header are never passed </span>
                   <span style="color: #ff7f24;"># to a raw socket, we can *not* get hoplimit field.. </span>
                   <span style="color: #ff7f24;"># I hoped that a socket option would help, but it's not </span>
                   <span style="color: #ff7f24;"># supported: </span>
                   <span style="color: #ff7f24;">#   pingSocket.setsockopt(IPPROTO_IPV6, IPV6_RECVHOPLIMIT, 1) </span>
                   <span style="color: #ff7f24;"># so we can't fetch hoplimit.. </span>

                   <span style="color: #ff7f24;"># fetch hoplimit </span>
                   <span style="color: #ff7f24;">#rawPongHop = struct.unpack("c", pong[7])[0] </span>

                   <span style="color: #ff7f24;"># fetch pong header </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pongHeader</span> = pong[0:8] 
                   pongType, pongCode, pongChksum, pongID, <span style="color: #ffebcd; background-color: #2f4f4f;">pongSeqnr</span> = \
                             struct.unpack(<span style="color: #ffa07a;">"bbHHh"</span>, pongHeader) 

                   <span style="color: #ff7f24;"># fetch starttime from pong </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">starttime</span> = struct.unpack(<span style="color: #ffa07a;">"d"</span>, pong[8:16])[0] 

               <span style="color: #ff7f24;"># IPv4 </span>
               <span style="color: #00ffff;">else:</span> 
                   <span style="color: #ff7f24;"># time to live </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">rawPongHop</span> = struct.unpack(<span style="color: #ffa07a;">"s"</span>, pong[8])[0] 

                   <span style="color: #ff7f24;"># convert TTL from 8 bit to 16 bit integer </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pongHop</span> = <span style="color: #b0c4de;">int</span>(binascii.hexlify(<span style="color: #b0c4de;">str</span>(rawPongHop)), 16) 

                   <span style="color: #ff7f24;"># fetch pong header </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pongHeader</span> = pong[20:28] 
                   pongType, pongCode, pongChksum, pongID, <span style="color: #ffebcd; background-color: #2f4f4f;">pongSeqnr</span> = \
                             struct.unpack(<span style="color: #ffa07a;">"bbHHh"</span>, pongHeader) 

                   <span style="color: #ff7f24;"># fetch starttime from pong </span>
                   <span style="color: #ffebcd; background-color: #2f4f4f;">starttime</span> = struct.unpack(<span style="color: #ffa07a;">"d"</span>, pong[28:36])[0] 

               <span style="color: #ff7f24;"># valid ping packet received? </span>
               <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> pongSeqnr == start: 
                   <span style="color: #ffebcd; background-color: #2f4f4f;">pong</span> = <span style="color: #00ffff;">None</span> 

           <span style="color: #ff7f24;"># NO data on socket - timeout waiting for answer </span>
           <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> pong: 
               <span style="color: #00ffff;">if</span> alive: 
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"no reply from %s (%s)"</span> % (<span style="color: #b0c4de;">str</span>(node), <span style="color: #b0c4de;">str</span>(host)) 
               <span style="color: #00ffff;">else:</span> 
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"ping timeout: %s (icmp_seq=%d) "</span> % (host, start) 

               <span style="color: #ff7f24;"># do not wait if just sending one packet </span>
               <span style="color: #00ffff;">if</span> number != 1 <span style="color: #00ffff;">and</span> start &lt; number: 
                   time.sleep(flood ^ 1) 
               <span style="color: #ffebcd; background-color: #2f4f4f;">start</span> += 1 
               <span style="color: #00ffff;">continue</span>  <span style="color: #ff7f24;"># lost a packet - try again </span>

           <span style="color: #ffebcd; background-color: #2f4f4f;">triptime</span>  = endtime - starttime <span style="color: #ff7f24;"># compute RRT </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">tsum</span>     += triptime            <span style="color: #ff7f24;"># triptime for all packets (stddev) </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">tsumsq</span>   += triptime * triptime <span style="color: #ff7f24;"># triptime^2  for all packets (stddev) </span>

           <span style="color: #ff7f24;"># compute statistic </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">maxt</span> = <span style="color: #b0c4de;">max</span> ((triptime, maxt)) 
           <span style="color: #ffebcd; background-color: #2f4f4f;">mint</span> = <span style="color: #b0c4de;">min</span> ((triptime, mint)) 

           <span style="color: #00ffff;">if</span> alive: 
               <span style="color: #b0c4de;">print</span> str(node) + <span style="color: #ffa07a;">" ("</span> + <span style="color: #b0c4de;">str</span>(host) +<span style="color: #ffa07a;">") is alive"</span> 
           <span style="color: #00ffff;">else:</span> 
               <span style="color: #00ffff;">if</span> ipv6: 
                   <span style="color: #ff7f24;"># size + 8 = payload + header </span>
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"%d bytes from %s: icmp_seq=%d time=%.5f ms"</span> % \
                         (size+8, host, pongSeqnr, triptime*1000) 
               <span style="color: #00ffff;">else:</span> 
                   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"%d bytes from %s: icmp_seq=%d ttl=%s time=%.5f ms"</span> % \
                         (size+8, host, pongSeqnr, pongHop, triptime*1000) 

           <span style="color: #ff7f24;"># do not wait if just sending one packet </span>
           <span style="color: #00ffff;">if</span> number != 1 <span style="color: #00ffff;">and</span> start &lt; number: 
               <span style="color: #ff7f24;"># if flood = 1; do not sleep - just ping                </span>
               time.sleep(flood ^ 1) <span style="color: #ff7f24;"># wait before send new packet </span>

           <span style="color: #ff7f24;"># the last thing to do is update the counter - else the value </span>
           <span style="color: #ff7f24;"># (can) get wrong when computing summary at the end (if user </span>
           <span style="color: #ff7f24;"># hit ctrl-c when pinging) </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">start</span> += 1 
           <span style="color: #ff7f24;"># end ping send/recv while </span>

   <span style="color: #ff7f24;"># if user ctrl-d or ctrl-c </span>
   <span style="color: #00ffff;">except</span> (<span style="color: #b0c4de;">EOFError</span>, <span style="color: #b0c4de;">KeyboardInterrupt</span>): 
       <span style="color: #ff7f24;"># if user disrupts ping, it is most likly done before </span>
       <span style="color: #ff7f24;"># the counter get updates - if do not update it here, the </span>
       <span style="color: #ff7f24;"># summary get all wrong. </span>
       <span style="color: #ffebcd; background-color: #2f4f4f;">start</span> += 1 
       <span style="color: #00ffff;">pass</span> 

   <span style="color: #ff7f24;"># compute and print som stats </span>
   <span style="color: #ff7f24;"># stddev computation based on ping.c from FreeBSD </span>
   <span style="color: #00ffff;">if</span> start != 0 <span style="color: #00ffff;">or</span> lost &gt; 0:  <span style="color: #ff7f24;"># do not print stats if 0 packet sent </span>
       <span style="color: #ffebcd; background-color: #2f4f4f;">start</span> -= 1              <span style="color: #ff7f24;"># since while is '&lt;=' </span>
       <span style="color: #ffebcd; background-color: #2f4f4f;">avg</span> = tsum / start      <span style="color: #ff7f24;"># avg round trip </span>
       <span style="color: #ffebcd; background-color: #2f4f4f;">vari</span> = tsumsq / start - avg * avg 
       <span style="color: #ff7f24;"># %-packet lost </span>
       <span style="color: #00ffff;">if</span> start == lost: 
           <span style="color: #ffebcd; background-color: #2f4f4f;">plost</span> = 100 
       <span style="color: #00ffff;">else:</span> 
           <span style="color: #ffebcd; background-color: #2f4f4f;">plost</span> = (lost/start)*100 

       <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> alive: 
           <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"\n--- %s ping statistics ---"</span> % node 
           <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"%d packets transmitted, %d packets received, %d%% packet loss"</span> % \
                 (start, start-lost, plost) 
           <span style="color: #ff7f24;"># don't display summary if 100% packet-loss </span>
           <span style="color: #00ffff;">if</span> plost != 100: 
               <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"round-trip min/avg/max/stddev = %.3f/%.3f/%.3f/%.3f ms"</span> % \
                     (mint*1000, (tsum/start)*1000, maxt*1000, math.sqrt(vari)*1000) 

   pingSocket.close() 

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">_error</span>(err): 
   <span style="color: #ffa07a;">"""Exit if running standalone, else raise an exception </span>
<span style="color: #ffa07a;">   """</span> 

   <span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">__name__</span> == <span style="color: #ffa07a;">'__main__'</span>: 
       <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"%s: %s"</span> % (os.path.basename(sys.argv[0]), <span style="color: #b0c4de;">str</span>(err)) 
       <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"Try `%s --help' for more information."</span> % os.path.basename(sys.argv[0]) 
       sys.exit(1) 
   <span style="color: #00ffff;">else:</span> 
       <span style="color: #00ffff;">raise</span> <span style="color: #b0c4de;">Exception</span>, <span style="color: #b0c4de;">str</span>(err) 

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">_usage</span>(): 
   <span style="color: #ffa07a;">"""Print usage if run as a standalone program </span>
<span style="color: #ffa07a;">   """</span> 
   <span style="color: #b0c4de;">print</span> <span style="color: #ffa07a;">"""usage: %s [OPTIONS] HOST </span>
<span style="color: #ffa07a;">Send ICMP ECHO_REQUEST packets to network hosts. </span>

<span style="color: #ffa07a;">Mandatory arguments to long options are mandatory for short options too. </span>
<span style="color: #ffa07a;"> -c, --count=N    Stop after sending (and receiving) 'N' ECHO_RESPONSE </span>
<span style="color: #ffa07a;">                  packets. </span>
<span style="color: #ffa07a;"> -s, --size=S     Specify the number of data bytes to be sent. The default </span>
<span style="color: #ffa07a;">                  is 56, which translates into 64 ICMP data bytes when </span>
<span style="color: #ffa07a;">                  combined with the 8 bytes of ICMP header data. </span>
<span style="color: #ffa07a;"> -f, --flood      Flood ping. Outputs packets as fast as they come back. Use </span>
<span style="color: #ffa07a;">                  with caution! </span>
<span style="color: #ffa07a;"> -6, --ipv6       Ping using IPv6. </span>
<span style="color: #ffa07a;"> -t, --timeout=s  Specify a timeout, in seconds, before a ping packet is </span>
<span style="color: #ffa07a;">                  considered 'lost'. </span>
<span style="color: #ffa07a;"> -h, --help       Display this help and exit </span>

<span style="color: #ffa07a;">Report bugs to lars [at] gnist org"""</span> % os.path.basename(sys.argv[0]) 


<span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">__name__</span> == <span style="color: #ffa07a;">'__main__'</span>: 
   <span style="color: #ffa07a;">"""Main loop </span>
<span style="color: #ffa07a;">   """</span> 

   <span style="color: #ff7f24;"># version control </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">version</span> = string.split(string.split(sys.version)[0][:3], <span style="color: #ffa07a;">"."</span>) 
   <span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">map</span>(int, version) &lt; [2, 3]: 
       _error(<span style="color: #ffa07a;">"You need Python ver 2.3 or higher to run!"</span>) 

   <span style="color: #00ffff;">try:</span> 
       <span style="color: #ff7f24;"># opts = arguments recognized, </span>
       <span style="color: #ff7f24;"># args = arguments NOT recognized (leftovers) </span>
       opts, <span style="color: #ffebcd; background-color: #2f4f4f;">args</span> = getopt.getopt(sys.argv[1:-1], <span style="color: #ffa07a;">"hat:6c:fs:"</span>, 
                                  [<span style="color: #ffa07a;">"help"</span>, <span style="color: #ffa07a;">"alive"</span>, <span style="color: #ffa07a;">"timeout="</span>, <span style="color: #ffa07a;">"ipv6"</span>, 
                                   <span style="color: #ffa07a;">"count="</span>, <span style="color: #ffa07a;">"flood"</span>, <span style="color: #ffa07a;">"packetsize="</span>]) 
   <span style="color: #00ffff;">except</span> <span style="color: #b0c4de;">getopt.GetoptError</span>: 
       <span style="color: #ff7f24;"># print help information and exit: </span>
       _error(<span style="color: #ffa07a;">"illegal option(s) -- "</span> + <span style="color: #b0c4de;">str</span>(sys.argv[1:])) 

   <span style="color: #ff7f24;"># test whether any host given </span>
   <span style="color: #00ffff;">if</span> <span style="color: #b0c4de;">len</span>(sys.argv) &gt;= 2: 
       <span style="color: #ffebcd; background-color: #2f4f4f;">node</span> = sys.argv[-1:][0]   <span style="color: #ff7f24;"># host to be pinged </span>
       <span style="color: #00ffff;">if</span> node[0] == <span style="color: #ffa07a;">'-'</span> <span style="color: #00ffff;">or</span> node == <span style="color: #ffa07a;">'-h'</span> <span style="color: #00ffff;">or</span> node == <span style="color: #ffa07a;">'--help'</span> :  
           _usage() 
   <span style="color: #00ffff;">else:</span> 
       _error(<span style="color: #ffa07a;">"No arguments given"</span>) 

   <span style="color: #00ffff;">if</span> args: 
       _error(<span style="color: #ffa07a;">"illegal option -- %s"</span> % <span style="color: #b0c4de;">str</span>(args)) 

   <span style="color: #ff7f24;"># default variables </span>
   <span style="color: #ffebcd; background-color: #2f4f4f;">alive</span> = 0; <span style="color: #ffebcd; background-color: #2f4f4f;">timeout</span> = 1.0; <span style="color: #ffebcd; background-color: #2f4f4f;">ipv6</span> = 0; <span style="color: #ffebcd; background-color: #2f4f4f;">count</span> = sys.maxint; 
   <span style="color: #ffebcd; background-color: #2f4f4f;">flood</span> = 0; <span style="color: #ffebcd; background-color: #2f4f4f;">size</span> = ICMP_DATA_STR 

   <span style="color: #ff7f24;"># run through arguments and set variables </span>
   <span style="color: #00ffff;">for</span> o, a <span style="color: #00ffff;">in</span> opts: 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-h"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--help"</span>:    <span style="color: #ff7f24;"># display help and exit </span>
           _usage() 
           sys.exit(0) 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-t"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--timeout"</span>: <span style="color: #ff7f24;"># timeout before "lost" </span>
           <span style="color: #00ffff;">try:</span> 
               <span style="color: #ffebcd; background-color: #2f4f4f;">timeout</span> = <span style="color: #b0c4de;">float</span>(a) 
           <span style="color: #00ffff;">except:</span> 
               _error(<span style="color: #ffa07a;">"invalid timout: '%s'"</span> % <span style="color: #b0c4de;">str</span>(a)) 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-6"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--ipv6"</span>:    <span style="color: #ff7f24;"># ping ipv6 </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">ipv6</span> = 1 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-c"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--count"</span>:   <span style="color: #ff7f24;"># how many pings? </span>
           <span style="color: #00ffff;">try:</span> 
               <span style="color: #ffebcd; background-color: #2f4f4f;">count</span> = <span style="color: #b0c4de;">int</span>(a) 
           <span style="color: #00ffff;">except:</span> 
               _error(<span style="color: #ffa07a;">"invalid count of packets to transmit: '%s'"</span> % <span style="color: #b0c4de;">str</span>(a)) 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-f"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--flood"</span>:   <span style="color: #ff7f24;"># no delay between ping send </span>
           <span style="color: #ffebcd; background-color: #2f4f4f;">flood</span> = 1 
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-s"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--packetsize"</span>:  <span style="color: #ff7f24;"># set the ping payload size </span>
           <span style="color: #00ffff;">try:</span> 
               <span style="color: #ffebcd; background-color: #2f4f4f;">size</span> = <span style="color: #b0c4de;">int</span>(a) 
           <span style="color: #00ffff;">except:</span> 
               _error(<span style="color: #ffa07a;">"invalid packet size: '%s'"</span> % <span style="color: #b0c4de;">str</span>(a)) 
       <span style="color: #ff7f24;"># just send one packet and say "it's alive" </span>
       <span style="color: #00ffff;">if</span> o == <span style="color: #ffa07a;">"-a"</span> <span style="color: #00ffff;">or</span> o == <span style="color: #ffa07a;">"--alive"</span>:  
           <span style="color: #ffebcd; background-color: #2f4f4f;">alive</span> = 1 

   <span style="color: #ff7f24;"># here we send </span>
   pingNode(<span style="color: #ffebcd; background-color: #2f4f4f;">alive</span>=alive, <span style="color: #ffebcd; background-color: #2f4f4f;">timeout</span>=timeout, <span style="color: #ffebcd; background-color: #2f4f4f;">ipv6</span>=ipv6, <span style="color: #ffebcd; background-color: #2f4f4f;">number</span>=count, 
            <span style="color: #ffebcd; background-color: #2f4f4f;">node</span>=node, <span style="color: #ffebcd; background-color: #2f4f4f;">flood</span>=flood, <span style="color: #ffebcd; background-color: #2f4f4f;">size</span>=size) 
   <span style="color: #ff7f24;"># if we made it this far, do a clean exit </span>
   sys.exit(0) 

<span style="color: #ff7f24;">### </span><span style="color: #ff7f24;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Python "pseudo-inplace" file contents</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #00ffff;">import</span> fileinput
<span style="color: #00ffff;">for</span> line <span style="color: #00ffff;">in</span> file.input(<span style="color: #ffa07a;">'name.txt'</span>, <span style="color: #ffebcd; background-color: #2f4f4f;">inplace</span>=1):
    <span style="color: #b0c4de;">print</span> line
    <span style="color: #00ffff;">if</span> line.startswith(<span style="color: #ffa07a;">'something'</span>):
        pirnt <span style="color: #ffa07a;">'xxx'</span>  <span style="color: #ff7f24;">#insert</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Python send simple Email</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #00ffff;">import</span> smtplib

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">sendEmail</span>(to):
    <span style="color: #ffebcd; background-color: #2f4f4f;">fromaddr</span> = <span style="color: #ffa07a;">'xx@gmail.com'</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">toaddrs</span>  = to <span style="color: #ff7f24;">#['xxx', 'xxx']</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">msg</span> = <span style="color: #ffa07a;">'test'</span>

    <span style="color: #ffebcd; background-color: #2f4f4f;">username</span> = <span style="color: #ffa07a;">''</span>
    <span style="color: #ffebcd; background-color: #2f4f4f;">password</span> = <span style="color: #ffa07a;">''</span>

    <span style="color: #ffebcd; background-color: #2f4f4f;">server</span> = smtplib.SMTP(<span style="color: #ffa07a;">'smtp.gmail.com'</span>, 587)
    server.ehlo()
    server.starttls()
    server.login(username, password)
    server.sendmail(fromaddr, toaddrs, msg)
    server.quit()
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">compare "version-style" strings</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>use <code>distutils.version</code>
<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span style="color: #00ffff;">from</span> distutils.version <span style="color: #00ffff;">import</span> LooseVersion, StrictVersion
&gt;&gt;&gt; LooseVersion(<span style="color: #ffa07a;">"2.3.1"</span>) &lt; LooseVersion(<span style="color: #ffa07a;">"10.1.2"</span>)
<span style="color: #00ffff;">True</span>
&gt;&gt;&gt; StrictVersion(<span style="color: #ffa07a;">"2.3.1"</span>) &lt; StrictVersion(<span style="color: #ffa07a;">"10.1.2"</span>)
<span style="color: #00ffff;">True</span>
</pre>
</div>
</li>
<li>use <code>tuple</code>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #00ffff;">def</span> <span style="color: #87cefa;">versiontuple</span>(v):
    <span style="color: #00ffff;">return</span> <span style="color: #b0c4de;">tuple</span>(map(int, (v.split(<span style="color: #ffa07a;">"."</span>))))

&gt;&gt;&gt; versiontuple(<span style="color: #ffa07a;">"2.3.1"</span>) &gt; versiontuple(<span style="color: #ffa07a;">"10.1.1"</span>)
<span style="color: #00ffff;">False</span>
</pre>
</div>
</li>
<li>use <code>re</code>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #00ffff;">import</span> re

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">mycmp</span>(version1, version2):
    <span style="color: #00ffff;">def</span> <span style="color: #87cefa;">normalize</span>(v):
        <span style="color: #00ffff;">return</span> [<span style="color: #b0c4de;">int</span>(x) <span style="color: #00ffff;">for</span> x <span style="color: #00ffff;">in</span> re.sub(r<span style="color: #ffa07a;">'(\.0+)*$'</span>,<span style="color: #ffa07a;">''</span>, v).split(<span style="color: #ffa07a;">"."</span>)]
    <span style="color: #00ffff;">return</span> <span style="color: #b0c4de;">cmp</span>(normalize(version1), normalize(version2))
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">windows install pip</h2>
<div class="outline-text-2" id="text-9">
<ol class="org-ol">
<li>Install Setup tools.
  <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#setuptools">http://www.lfd.uci.edu/~gohlke/pythonlibs/#setuptools</a>
</li>
<li>Install PIP
  <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#setuptools">http://www.lfd.uci.edu/~gohlke/pythonlibs/#setuptools</a>
</li>

<li>Add Python Scripts to the path Start -&gt; Edit environment variables
eg. C:\Python27\Scripts
</li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Shi Shougang</p>
<p class="date">Created: 2014-01-01 Wed 16:09</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.50.1 (<a href="http://orgmode.org">Org</a> mode 8.2.3a)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
